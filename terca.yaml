name: genkit_js
description: robust testing for common genkit JS development scenarios

# optional. points to the directory (relative to this file, cannot be a parent folder) to be copied before the test is run
workspaceDir: app

# matrix defines the test matrix. array entry of the matrix is then run with each possible combination of subsequent entries. individual fields in the matrix can also be turned into arrays but are then merged with their sibling fields

# for example,

# matrix:
#   - agent: [foo, bar]
#     rules: [null, rules1.md]

# would run twice - once for {agent: foo, rules: null} and once for {agent: bar, rules: rules1.md}

# however this:

# matrix:
#   - agent: [foo, bar]
#   - rules: [null, rules1.md]

# would run four times:
# {agent: foo, rules: null}
# {agent: foo, rules: rules1.md}
# {agent: bar, rules: null}
# {agent: bar, rules: rules1.md}
matrix:
  # list of CLI agents to run this suite against
  - agents: [gemini, claude, codex, opencode]
  - rules: [null, rules_a.md]
    mcpServers:
      - null
      - genkit:
          command: genkit
          args: [mcp]

# optional. a list of actions to take before running each of the tests
before:
  # command runs a shell command in the spawned workspace dir
  - command: pnpm i
  # copy can copy files relative to the terca.yaml file to the spawned workspace dir
  - copy:
      path/relative/to/this/yaml/file.ts: test-spawned/workspaceDir/relative/path.ts
      another/path.ts: another/target/path.ts
  # files writes file content to files:
  - test-spawned/workspaceDir/relative/path.ts: |
      content of file
      that will be inserted at the provided path
    another/file.ts: |
      another file contents

tests:
  - # a machine_friendly name for the test
    name: image_generation
    # optional. a description of what the test is doing
    description: create a genkit flow
    # this is what gets passed to the coding agent as its prompt e.g. through `gemini -p "..."`
    prompt: create an image generation flow that takes band name, decade, and genre and generates an album cover
    # these are before actions that
    before:
      - copy: # ....
    evaluate:
      # commandSuccess runs a shell command and returns a 1.0 (success) if zero exit code or a 0.0 (failure) if non-zero exit code
      - name: code_compiles
        commandSuccess: pnpm build
      # ... other types of evaluations will come in the future, but we can start with just commandSuccess
